rules:
- id: potential-secret-leak-inputs-context
  patterns:
  - pattern-inside: |
      on:
        ...
        workflow_dispatch:
          inputs:
            ...
            $SECRET_INPUT:
              ...
              description: $DESC
              required: true
              ...
  languages:
  - yaml
  metadata:
    category: security
    subcategory:
    - vuln
    cwe:
    - 'CWE-202: Exposure of Sensitive Information Through Data Queries'
    confidence: MEDIUM
    likelihood: LOW
    impact: MEDIUM
    owasp:
    - A4:2021 Insecure Design
    technology:
    - Github Actions
    severity: WARNING
    references:
    - https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#providing-inputs
    - https://0xn3va.gitbook.io/cheat-sheets/ci-cd/github/actions#misuse-of-secrets-in-manual-workflows
    - https://docs.prismacloud.io/en/enterprise-edition/policy-reference/build-integrity-policies/github-actions-policies/github-actions-contain-workflow-dispatch-input-parameters
  message: "Sensitive data should not be used directly in manual workflow inputs contexts,
    as it can be exposed in the workflow logs. This rule has detected that sensitive
    data, such as secrets, might be used in the **'$SECRET_INPUT'** parameter, called
    from the inputs context. This could lead to unintentional exposure of sensitive
    information.\n\nHow to fix: First check if $SECRET_INPUT is in fact sensive. Then,
    instead of using it directly in the inputs, use GitHub Secrets environment variables.\n\n\n**Instead
    of:**\n\n\n  ``` \n  run: |\n  ${{ github.event.inputs.$SECRET_INPUT }}\"\n  ```\n\n
    \ \n\n**Use:**\n\n  ```\n  env:\n  ${{ secrets.$SECRET_INPUT }}\n  ```"
  severity: WARNING
